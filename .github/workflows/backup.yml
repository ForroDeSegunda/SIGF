name: Backup

on: [push]

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      - name: Install pg_dump
        uses: ikalnytskyi/action-setup-postgres@v5

      - name: Backup
        run: |
          pg_dump postgres://postgres.${{ secrets.DEV_SUPABASE_REFERENCE_ID }}:${{ secrets.DEV_SUPABASE_PASSWORD }}@aws-0-sa-east-1.pooler.supabase.com:6543/postgres --format=c > dump.dump
          echo "Backup created at $(date)"

      - name: Upload Backup
        uses: actions/upload-artifact@v2
        with:
          name: backup
          path: ./
